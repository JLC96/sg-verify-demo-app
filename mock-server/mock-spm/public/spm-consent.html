<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width">

  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">
  <link rel="mask-icon" href="assets/images/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i,900,900i" rel="stylesheet">
  <link href="assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="assets/vendor/themify-icons/css/themify-icons.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="assets/css/style.css">

  <title>SingPass Mobile (TEST) Consent Screen</title>
  <meta name="keywords" content="" />
  <meta name="author" content="Royce Cheng" />
</head>

<body style="background-color:#F5F5F5;">

  <!-- consent screen start -->
  <div id="spm-header">
    <div class="container">
      <a href="spm-home.html" class="close-trigger"><span>Close</span></a>
      <strong>SingPass Mobile (TEST)</strong>
    </div>
  </div>

  <div id="main-consent" class="container">
    <div class="row">
      <div class="col-sm-12 mt-2 mb-2">
        <p class="f-20 mb-2">Are you sending your details to:</p>
      </div>
      <div class="col-sm-12">
        <div class="card card-shadow red-top">
          <div class="card-header">
            <div class="text-center mb-0">
              <img src="assets/images/QR-login@1.5x.png" style="margin: auto;width: 160px;">
              <p class="mt-3 mb-2">
                <strong>SAMPLE APP</strong>
                <br>VISITOR MANAGEMENT EXAMPLE
              </p>
            </div>
          </div>
          <div class="card-body">
            <div class="text-label">
              Name
            </div>
            <div class="text-data" id="name">
            </div>
            <hr class="sep">
            <div class="text-label">
              Partial NRIC
            </div>
            <div class="text-data" id="partialuinfin">
            </div>
            <hr class="sep">
            <div class="text-label">
              Race
            </div>
            <div class="text-data" id="race">
            </div>
            <hr class="sep">
            <div class="text-label">
              Date of Birth
            </div>
            <div class="text-data" id="dob">
            </div>
            <hr class="sep">
            <div class="text-label">
              Mobile No.
            </div>
            <div class="text-data" id="mobileno">
            </div>
          </div>
        </div>
        <div class="slide-to-send">
          <input type="range" value="0" class="pullee" onchange="onSlideComplete()"/>
          <span>SLIDE TO SEND</span>
        </div>
      </div>
    </div>
  </div>
  <!-- consent screen end -->


  <script type="text/javascript" src="assets/vendor/jquery-3.4.1.min.js"></script>
  <!-- <script type="text/javascript" src="assets/vendor/jquery-ui/js/jquery-ui.min.js"></script> -->
  <script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src='assets/js/custom.js'></script>

  <script>
    function onSlideComplete() {
      slider = document.querySelector('.slide-to-send');
      sliderInput = slider.querySelector('input');

      if(sliderInput.value==100){
        $.ajax({
  				url: "/myinfo",
  				data: {},
  				type: "GET", // get from serverside
  				success: function(data) {
            console.log(data);
  					// successful response from serverside
  					if (data.statusCode == 200) { // successful
  						// fill up the application form
              window.location.href = "spm-success.html";

  					} else {
  						// error occured
  						alert("ERROR:" + JSON.stringify(data.msg));
  					}

  				}
  			});
      }
    }

    $.ajax({
        url: "/getCurrentProfile",
        type: "GET",
        success: function(data) {
          console.log(data);
          populate(data);
        },
        dataType: "json",
        timeout: 5000
    });

    function populate(data){
      document.getElementById('name').innerHTML = data.name ? data.name.value : "";
      document.getElementById('partialuinfin').innerHTML = data.partialuinfin ? data.partialuinfin.value : "";
      document.getElementById('dob').innerHTML = data.dob ? formatDate(data.dob.value) : "";
      document.getElementById('race').innerHTML = data.race ? data.race.desc : "";
      document.getElementById('mobileno').innerHTML = data.mobileno ? data.mobileno.nbr.value : "";
    }

    function formatDate(date) {
      var d = new Date(date);
      var monthNames = [
        "Jan", "Feb", "Mar",
        "Apr", "May", "Jun", "Jul",
        "Aug", "Sep", "Oct",
        "Nov", "Dec"
      ];

      var day = d.getDate();
      var monthIndex = d.getMonth();
      var year = d.getFullYear();

      return day + ' ' + monthNames[monthIndex] + ' ' + year;
    }

console.log(formatDate(new Date()));
  </script>
</body>

</html>
